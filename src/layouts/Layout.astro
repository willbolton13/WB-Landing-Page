---
import {ViewTransitions} from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import 'bootstrap/dist/css/bootstrap.min.css';


export interface Props {
  title: string;
  heroImageUrl?: string;
}

const { title, heroImageUrl } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" viewport-fit=cover">
    <title>{title}</title>
    <ViewTransitions />
    
    <!-- Preconnect to Contentful's CDN for faster image loading -->
    <link rel="preconnect" href="https://images.ctfassets.net">
    <link rel="dns-prefetch" href="https://images.ctfassets.net">
    <link rel="preload" href="/fonts/Jost-VariableFont_wght.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/FuturaPTExtraBold.woff2" as="font" type="font/woff2" crossorigin>

  {heroImageUrl && (
    <>
      <link 
        rel="preload"
        as="image"
        href={heroImageUrl.replace('w=1920', 'w=768')}
        type="image/webp"
        media="(max-width: 768px)"
      />
      <link 
        rel="preload"
        as="image"
        href={heroImageUrl}
        type="image/webp"
        media="(min-width: 769px)"
      />
    </>
  )}
    
    <!-- Slot for page-specific preload tags (like hero images) -->
    <slot name="head" />
    <!--<link href="/Users/willbolton/Documents/GitHub/WB-Landing-Page/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">-->
    
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="WB Student" />

    <style>

      @font-face {
        font-family: 'Jost';
        font-style: normal;
        font-weight: 100 900;
        font-display: swap;
        src: url('/fonts/Jost-VariableFont_wght.woff2') format('woff2-variations'),
             url('/fonts/Jost-VariableFont_wght.woff2') format('woff2');
      }

      @font-face {
        font-family: 'Jost';
        font-style: italic;
        font-weight: 100 900;
        font-display: swap;
        src: url('/fonts/Jost-Italic-VariableFont_wght.woff2') format('woff2-variations'), 
             url('/fonts/Jost-Italic-VariableFont_wght.woff2') format('woff2');
      }

        @font-face {
        font-family: 'Futura PT';
        font-style: normal;
        font-weight: 800;
        font-display: swap;
        src: url('/fonts/FuturaPTExtraBold.woff2') format('woff2-variations'),
             url('/fonts/FuturaPTExtraBold.woff2') format('woff2');
      }

        /* Apply to body */
      body {
        font-family: 'Jost', system-ui, -apple-system, sans-serif;
      }
      
      /* Ensure headings use the right weights */
      h1, .display-4 {
        font-family: 'Futura PT', system-ui, -apple-system, sans-serif;
        font-weight: 800;
      }
      
      h2, h3 {
        font-weight: 700;
      }
      
      strong, b {
        font-weight: 700;
      }

      .page-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .main-content {
        flex: 1 0 auto;
      }

      .site-footer {
        flex-shrink: 0;
        /* your existing footer styles */
      }

    </style>
    
</head>

<body>
    <div class="page-wrapper">
        <Header transition:name="header" transition:persist />
        
        <div transition:name="main-content" class="main-content">
            <slot />
        </div>

        <Footer transition:name="footer" transition:persist />
    </div>
    
    <!-- Bootstrap JS -->
    <script> import "bootstrap/dist/js/bootstrap.bundle.min.js"; </script>
    
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      import { Offcanvas } from 'bootstrap';
    // Initialize once flag
    let initialized = false;

    function initializePage() {
        // Create Lucide icons
        lucide.createIcons();
        
        // Close any open Bootstrap offcanvas before navigation
        if (!initialized) {
            document.addEventListener('astro:before-preparation', () => {
                // Close any open offcanvas
                const offcanvasElement = document.querySelector('.offcanvas.show');
                if (offcanvasElement) {
                    const bsOffcanvas = Offcanvas.getInstance(offcanvasElement);
                    if (bsOffcanvas) {
                        bsOffcanvas.hide();
                    }
                }
            });
            initialized = true;
        }
    }

    // Run on initial load and after each navigation
    document.addEventListener('astro:page-load', initializePage);
    </script>
</body>
</html>

<style is:global>
  /* CSS Variables */
  :root {
    --background-color: #ffffff;
    --header-color: #000000;
    --footer-color: #000000;
    --text-color: #ffffff;
    --accent-yellow: #F6DD0D;
    --button-text-color: #000000;
    --accent-red: #DE0029;
    --accent-green: #6D9D7E;
    --icon-size: 100px;
  }

  /* Base styles */
  body {
    background-color: var(--background-color);
    min-height: 100dvh; /* Instead of 100vh */
    display: flex;
    flex-direction: column;
  }

  /* Animation classes for initial load */
  html {
    scroll-behavior: smooth;
  }

  .site-footer {
    background-color: var( --footer-color);
    color: var(--text-color);
    padding: 5rem 0 2rem 0;
    position: relative;
    text-align: center;
  }

    .hero-picture,
  .hero-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 3;
    filter: contrast(80%);
    filter: saturate(80%);
    filter: brightness(0.7);
  }

  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    opacity: 0;
    transition: opacity 0.6s ease-out;

  }

  .offcanvas {
    transition: transform 0.2s ease-in-out !important;
  }

  main.container {
    position: relative;
    z-index: 2;
  }

  .course-selection {
    font-family: "Jost", sans-serif;
  }

  .text-center {
  font-family: 'Futura PT';
   min-height: 150px; text-align: center;
  }
  .display-4 {
    font-weight: 800;
    text-transform: uppercase;
  }

  .hero-blur {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  filter: blur(20px);  /* CSS blur, not URL parameter */
  transform: scale(1.1);
  opacity: 0.7;
  z-index: 2;
  transition: opacity 0.3s ease-out;
}

  .portal-card {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 250px;
    padding: 20px;
    text-align: center;
    text-decoration: none;
    background-color: var(--accent-yellow);
    color: var(--button-text-color);
    transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
  }

  .portal-card h3 {
    font-family: "Futura PT", sans-serif;
    font-size: 2rem;
    text-transform: uppercase;
    margin: 0;
    color: inherit;
  }

  .portal-card:hover {
    background-color: var(--text-color);
    color: var(--button-text-color);
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  }

  .portal-card-icon {
    color: inherit;
    width: var(--icon-size);
    height: var(--icon-size);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    flex-shrink: 0;
  }

  .portal-card-icon svg {
    width: 100%;
    height: 100%;
    stroke: currentColor;
  }

  .portal-card:hover {
    background-color: var(--text-color);
    color: var(--button-text-color);
    transform: scale(1.02) !important;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  }

  .portal-card-icon {
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
  }

  .portal-card-icon svg {
    width: var(--icon-size);
    height: var(--icon-size);
    stroke: currentColor;
  }

  .portal-card-subtitle {
    font-size: rem;
    font-weight: 400;
    text-transform: none;
    margin: 0;
    color: inherit;
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    padding: 0 20px;
    text-align: center;
  }

  /* Location content animation support
  .location-content {
    transition: opacity 0.4s ease, transform 0.4s ease, max-height 0.5s ease, margin-top 0.5s ease;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    margin-top: 0;
    pointer-events: none; 
  }

  .location-content.is-visible {
    opacity: 1;
    max-height: 1500px;
    pointer-events: auto;
    margin-top: 0; 
  }

  /* Horizontal slide animation for view transitions 
  @keyframes slide-out-left {
    from { 
      transform: translateX(0); 
      opacity: 1; 
    }
    to { 
      transform: translateX(-50px); 
      opacity: 0; 
    }
  }

  @keyframes slide-in-right {
    from { 
      transform: translateX(50px); 
      opacity: 0; 
    }
    to { 
      transform: translateX(0); 
      opacity: 1; 
    }
  }

  /* Only animate the main content
  ::view-transition-old(main-content) {
    animation: slide-out-left 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: slide-in-right 0.3s ease-in forwards;
  }

   */

  /* Alternative fade animation (comment out the above and uncomment below to use) */
  /*
  @keyframes fade-out {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  ::view-transition-old(main-content) {
    animation: fade-out 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: fade-in 0.3s ease-in forwards;
  }
  */

  /* Alternative scale animation (comment out the above and uncomment below to use) */
  /*
  @keyframes scale-out {
    from { 
      transform: scale(1); 
      opacity: 1; 
    }
    to { 
      transform: scale(0.95); 
      opacity: 0; 
    }
  }

  @keyframes scale-in {
    from { 
      transform: scale(1.05); 
      opacity: 0; 
    }
    to { 
      transform: scale(1); 
      opacity: 1; 
    }
  }

  ::view-transition-old(main-content) {
    animation: scale-out 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: scale-in 0.3s ease-in forwards;
  }
  */
</style>