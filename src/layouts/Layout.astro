---
import {ViewTransitions} from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import 'bootstrap/dist/css/bootstrap.min.css';


export interface Props {
  title: string;
  heroImageUrl?: string;
}

const { title, heroImageUrl } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" viewport-fit=cover">
    <title>{title}</title>
    <ViewTransitions />
    
    <!-- Preconnect to Contentful's CDN for faster image loading -->
    <link rel="preconnect" href="https://images.ctfassets.net">
    <link rel="dns-prefetch" href="https://images.ctfassets.net">
    <link rel="preload" href="/fonts/Jost-VariableFont_wght.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/FuturaPTExtraBold.woff2" as="font" type="font/woff2" crossorigin>

  {heroImageUrl && (
    <>
      <link 
        rel="preload"
        as="image"
        href={heroImageUrl.replace('w=1920', 'w=768')}
        type="image/webp"
        media="(max-width: 768px)"
      />
      <link 
        rel="preload"
        as="image"
        href={heroImageUrl}
        type="image/webp"
        media="(min-width: 769px)"
      />
    </>
  )}
    
    <!-- Slot for page-specific preload tags (like hero images) -->
    <slot name="head" />
    <!--<link href="/Users/willbolton/Documents/GitHub/WB-Landing-Page/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">-->
    
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="WB Student" />

    <style>

      @font-face {
        font-family: 'Jost';
        font-style: normal;
        font-weight: 100 900;
        font-display: swap;
        src: url('/fonts/Jost-VariableFont_wght.woff2') format('woff2-variations'),
             url('/fonts/Jost-VariableFont_wght.woff2') format('woff2');
      }

      @font-face {
        font-family: 'Jost';
        font-style: italic;
        font-weight: 100 900;
        font-display: swap;
        src: url('/fonts/Jost-Italic-VariableFont_wght.woff2') format('woff2-variations'), 
             url('/fonts/Jost-Italic-VariableFont_wght.woff2') format('woff2');
      }

        @font-face {
        font-family: 'Futura PT';
        font-style: normal;
        font-weight: 800;
        font-display: swap;
        src: url('/fonts/FuturaPTExtraBold.woff2') format('woff2-variations'),
             url('/fonts/FuturaPTExtraBold.woff2') format('woff2');
      }

        /* Apply to body */
      body {
        font-family: 'Jost', system-ui, -apple-system, sans-serif;
      }
      
      /* Ensure headings use the right weights
      h1, .display-4 {
        font-family: 'Futura PT', system-ui, -apple-system, sans-serif;
        font-weight: 800;
        text-transform: uppercase;
        font-size: clamp(2rem, 4vw + 0.5vh, 5rem);
      }
       */

      h2, h3 {
        font-weight: 700;
      }

      h5 {
        font-weight: 100;
      }

      
      strong, b {
        font-weight: 700;
      }

      .page-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .main-content {
        flex: 1 0 auto;
      }

      .site-footer {
        flex-shrink: 0;
        /* your existing footer styles */
      }

    </style>
    
</head>

<body>
    <div class="page-wrapper">
        <Header transition:name="header" transition:persist />
        
        <div transition:name="main-content" class="main-content">
            <slot />
        </div>

        <Footer transition:name="footer" transition:persist />
    </div>
    
<!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" data-astro-rerun></script>
    
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
    // Initialize once flag
    let initialized = false;

    function initializePage() {
        // Create Lucide icons
        lucide.createIcons();
        
        // Setup cleanup before navigation only once
        if (!initialized) {
            document.addEventListener('astro:before-preparation', () => {
                // Force close any open offcanvas and remove backdrop
                const offcanvasElement = document.querySelector('.offcanvas.show');
                if (offcanvasElement) {
                    // Remove the show class
                    offcanvasElement.classList.remove('show');
                    // Remove the backdrop if it exists
                    const backdrop = document.querySelector('.offcanvas-backdrop');
                    if (backdrop) {
                        backdrop.remove();
                    }
                    // Reset body styles
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                }
            });
            
            // Also clean up on page load in case something persisted
            document.addEventListener('astro:after-swap', () => {
                // Extra cleanup after page swap
                const strayBackdrop = document.querySelector('.offcanvas-backdrop');
                if (strayBackdrop) {
                    strayBackdrop.remove();
                }
                // Ensure body is reset
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';
            });
            
            initialized = true;
        }
    }

    // Run on initial load and after each navigation
    document.addEventListener('astro:page-load', initializePage);
    </script>
</body>
</html>

<style is:global>
  /* CSS Variables */
  :root {
    --background-color: #ffffff;
    --header-color: #121212;
    --footer-color: #121212;
    --text-color: #ffffff;
    --accent-yellow: #F6DD0D;
    --button-text-color: #121212;
    --accent-red: #DE0029;
    --accent-green: #6D9D7E;
    --icon-size: 50px;
    --brand-red: #DE0029;
    --brand-yellow: #F6DD0D;
    --brand-green: #6D9D7E;
    --brand-white: #FFFFFF;
    --brand-black: #121212;

  }

  /* Base styles */
  body {
    background-color: var(--background-color);
    min-height: 100dvh; /* Instead of 100vh */
    display: flex;
    flex-direction: column;
  }

  /* Animation classes for initial load */
  html {
    scroll-behavior: smooth;
  }

  .site-footer {
    background-color: var( --footer-color);
    color: var(--text-color);
    padding: 5rem 0 2rem 0;
    position: relative;
    text-align: center;
  }

    .hero-picture,
  .hero-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 3;
    filter: contrast(80%);
    filter: saturate(80%);
    filter: brightness(0.7);
  }

  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    opacity: 0;
    transition: opacity 0.6s ease-out;

  }

  /* Hero Text Classes */
.hero-title {
  font-family: 'Futura PT', system-ui, -apple-system, sans-serif;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  line-height: 0.9;
  color: var(--text-color);
  text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}

/* Size variants */
.hero-title--xl {
  /* Homepage - biggest impact */
  font-size: clamp(3rem, 8vw + 1vh, 8rem); 
  letter-spacing: -0.03em;
  line-height: 0.85;
}

.hero-title--lg {
  /* Campus pages */
  font-size: clamp(2.5rem, 6vw + 0.5vh, 6rem);
}

.hero-title--md {
  /* Course pages */
  font-size: clamp(2rem, 5vw + 0.5vh, 5rem);
}

.hero-title br {
  display: none;
}

@media (max-width: 768px) {
  .hero-title br {
    display: block;
  }
}

.hero-subtitle {
  font-family: 'Jost', system-ui, -apple-system, sans-serif;
  font-weight: 500;
  text-transform: uppercase;
  color: var(--background-color);
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
  margin-top: 1rem;
  opacity: 0;
  animation: heroFadeIn 0.8s ease-out 0.3s forwards;
}

.hero-subtitle--lg {
  font-size: clamp(1.5rem, 2.5vw, 2.5rem);
}

.hero-subtitle--md {
  font-size: clamp(1.2rem, 2vw, 2rem);
}

/* Optional: Add animation */
@keyframes heroFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.hero-title {
  animation: heroFadeIn 0.8s ease-out;
}


  .offcanvas {
    transition: transform 0.2s ease-in-out !important;
  }

  main.container {
    position: relative;
    z-index: 2;
  }

  .course-selection {
    font-family: "Jost", sans-serif;
  }

  .text-center {
  font-family: 'Futura PT';
   min-height: 150px; text-align: center;
  }

  .hero-blur {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  filter: blur(20px);  /* CSS blur, not URL parameter */
  transform: scale(1.1);
  opacity: 0.7;
  z-index: 2;
  transition: opacity 0.3s ease-out;
}

:root {
  --portal-card-height: 180px;
  --portal-icon-size: 50px;
  --portal-h3-size: 1.5rem;
  --portal-subtitle-size: 1rem;
  --portal-padding: 0px;
}

@media (min-width: 768px) {
  :root {
    --portal-card-height: 225px;
    --portal-icon-size: 60px;
    --portal-h3-size: 1.6rem;
    --portal-subtitle-size: 0.95rem;
    --portal-padding: 0px;
  }
}

@media (min-width: 992px) {
  :root {
    --portal-card-height: 250px;
    --portal-icon-size: 75px;
    --portal-h3-size: 1.8rem;
    --portal-subtitle-size: 1.2rem;
    --portal-padding: 20px;
  }
}

.portal-cards-container { /* or whatever wraps your cards */
  container-type: inline-size;
}

.portal-card {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: var(--portal-card-height);
    padding: var(--portal-padding);
    text-align: center;
    text-decoration: none;
    background-color: var(--accent-yellow);
    color: var(--button-text-color);
    transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
  }

  .portal-card h3 {
    font-family: "Futura PT", sans-serif;
    font-size: var(--portal-h3-size);
    text-transform: uppercase;
    margin: 0;
    color: inherit;
    line-height: 100%;
  }

  .portal-card-icon {
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    flex-shrink: 0;
  }

  .portal-card-icon svg {
    width: var(--portal-icon-size);
    height: var(--portal-icon-size);
    stroke: currentColor;
  }

  .portal-card:hover {
    background-color: var(--text-color);
    color: var(--button-text-color);
    transform: scale(1.02) !important;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  }

  .portal-card-subtitle {
    font-size: var(--portal-subtitle-size);
    font-weight: 250;
    text-transform: none;
    margin: 0;
    color: inherit;
    position: absolute;
    bottom: 10px;
    left: 0;
    right: 0;
    padding: 0 20px;
    text-align: center;
    line-height: 100%;
  }

    /* Portal card variants */
  .portal-card.custom-portal-card {
    /* Custom cards can have different colors */
    background-color: var(--accent-yellow);
  }

  .portal-card.portal-card-green {
    background-color: var(--accent-green);
    color: var(--text-color);
  }

</style>