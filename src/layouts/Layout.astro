---
import {ViewTransitions} from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

export interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <ViewTransitions />
    
    <!-- Preconnect to Contentful's CDN for faster image loading -->
    <link rel="preconnect" href="https://images.ctfassets.net">
    <link rel="dns-prefetch" href="https://images.ctfassets.net">
    
    <!-- Slot for page-specific preload tags (like hero images) -->
    <slot name="head" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">-->
    
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="WB Student" />
</head>

<body>
    <Header transition:name="header" transition:persist />
    
    <div transition:name="main-content">
        <slot />
    </div>

    <Footer transition:name="footer" transition:persist />
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
    // Initialize once flag
    let initialized = false;

    function initializePage() {
        // Create Lucide icons
        lucide.createIcons();
        
        // Close any open Bootstrap offcanvas before navigation
        if (!initialized) {
            document.addEventListener('astro:before-preparation', () => {
                // Close any open offcanvas
                const offcanvasElement = document.querySelector('.offcanvas.show');
                if (offcanvasElement) {
                    const bsOffcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
                    if (bsOffcanvas) {
                        bsOffcanvas.hide();
                    }
                }
            });
            initialized = true;
        }
    }

    // Run on initial load and after each navigation
    document.addEventListener('astro:page-load', initializePage);
    </script>
</body>
</html>

<style is:global>
  /* CSS Variables */
  :root {
    --background-color: #ffffff;
    --header-color: #000000;
    --text-color: #ffffff;
    --accent-yellow: #F6DD0D;
    --button-text-color: #000000;
    --accent-red: #DE0029;
    --accent-green: #6D9D7E;
    --icon-size: 100px;
  }

  /* Base styles */
  body {
    font-family: 'Futura', 'Jost', sans-serif;
    background-color: var(--background-color);
  }

  /* Animation classes for initial load */
  html {
    scroll-behavior: smooth;
  }

  .offcanvas {
    /* Default is 0.3s, let's make it faster */
    transition: transform 0.2s ease-in-out !important;
  }

  main.container {
    position: relative;
    z-index: 2;
    margin-top: -150px !important;
  }

  /* Location content animation support
  .location-content {
    transition: opacity 0.4s ease, transform 0.4s ease, max-height 0.5s ease, margin-top 0.5s ease;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    margin-top: 0;
    pointer-events: none; 
  }

  .location-content.is-visible {
    opacity: 1;
    max-height: 1500px;
    pointer-events: auto;
    margin-top: 0; 
  }

  /* Horizontal slide animation for view transitions 
  @keyframes slide-out-left {
    from { 
      transform: translateX(0); 
      opacity: 1; 
    }
    to { 
      transform: translateX(-50px); 
      opacity: 0; 
    }
  }

  @keyframes slide-in-right {
    from { 
      transform: translateX(50px); 
      opacity: 0; 
    }
    to { 
      transform: translateX(0); 
      opacity: 1; 
    }
  }

  /* Only animate the main content
  ::view-transition-old(main-content) {
    animation: slide-out-left 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: slide-in-right 0.3s ease-in forwards;
  }

   */

  /* Alternative fade animation (comment out the above and uncomment below to use) */
  /*
  @keyframes fade-out {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  ::view-transition-old(main-content) {
    animation: fade-out 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: fade-in 0.3s ease-in forwards;
  }
  */

  /* Alternative scale animation (comment out the above and uncomment below to use) */
  /*
  @keyframes scale-out {
    from { 
      transform: scale(1); 
      opacity: 1; 
    }
    to { 
      transform: scale(0.95); 
      opacity: 0; 
    }
  }

  @keyframes scale-in {
    from { 
      transform: scale(1.05); 
      opacity: 0; 
    }
    to { 
      transform: scale(1); 
      opacity: 1; 
    }
  }

  ::view-transition-old(main-content) {
    animation: scale-out 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: scale-in 0.3s ease-in forwards;
  }
  */
</style>