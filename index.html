<!--Testing Branch-->
<!DOCTYPE html>
<html lang="en">
<head>

    <script type="importmap">
    {
        "imports": {
        "motion": "https://cdn.skypack.dev/motion"
        }
    }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaterBear Student Portal</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="WB Student" />
    <link rel="manifest" href="./site.webmanifest" />

</head>
<body>

<header class="py-3">
        <div class="container d-flex justify-content-between align-items-center">
            <a href="https://waterbear.org.uk/" target="_blank" rel="noopener noreferrer"> <img src="img/white-hori@4x.png" alt="University Logo" style="height: 50px;"></a>

            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">QUICK LINKS</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>

                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Extra Link 1</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Extra Link 2</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Extra Link 3</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Extra Link 4</a>
                        </li>
                    </ul>
                </div>

                <div class="offcanvas-footer">
                    <a href="https://login.microsoftonline.com/common/oauth2/v2.0/logout" class="btn-logout-mobile">LOG OUT</a>
                </div>

            </div>

            </div>
    </header>

    <section class="hero-section">
        <img src="/img/hn-1536x796.jpg.webp">
        </section>

    <main class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-4">Welcome to your student portal</h1>
            <p class="lead location-prompt">Select a location to get started.</p>

            <div class="col-lg-6 mx-auto">
                <select class="form-select" id="location-select" aria-label="Select a location">
                    <option selected disabled>Choose your campus...</option>
                </select>
            </div>
        </div>



        <div class="row g-4 justify-content-center mb-4">
            <div class="col-lg-6 col-md-6">
                <a href="https://waterbear.instructure.com/login/canvas" target= "_blank" class="portal-card">

                    <div class="portal-card-icon">
                        <i data-lucide="square-library"></i>
                    </div>

                    <h3>Canvas</h3>
                    <p class="portal-card-subtitle">Learning Materials and Assignments</p>
                </a>
            </div>

            <div class="col-lg-6 col-md-6">
                <a href="https://timetabler.optime.cloud/" target= "_blank" class="portal-card">

                    <div class="portal-card-icon">
                    <i data-lucide="calendar-range"></i>
                    </div>

                    <h3>Timetabler</h3>
                    <p class="portal-card-subtitle">Classes and Bookings</p>
                </a>
            </div>
        </div>

    <div id="location-buttons-wrapper">
        <div id="buttons-container" class="row g-4 justify-content-center pb-5"></div>
    </div>

    <div id="location-info-wrapper">
        <div id="info-container"></div>
    </div>

    </main>

    <footer class="site-footer">
    <div class="container">

        <a href="#" class="back-to-top">â–² BACK TO TOP</a>

        <div class="row align-items-start">

            <div class="col-lg-3 col-md-6 mb-5 d-flex flex-column align-items-center">
                <ul class="footer-links">
                    <li><a href="#">Extra Link 1</a></li>
                    <li><a href="#">Extra Link 2</a></li>
                    <li><a href="#">Extra Link 3</a></li>
                    <li><a href="#">Extra Link 4</a></li>
                </ul>
            </div>

            <div class="col-lg-5 col-md-6 mb-4 d-flex flex-column align-items-center">
                <img src="/img/white-hori@4x.png" alt="WaterBear Logo" class="footer-logo mb-3">
                    <div class="social-icons mb-4">
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                        <a href="#"><i class="bi bi-linkedin"></i></a>
                        <a href="#"><i class="bi bi-youtube"></i></a>
                        <a href="#"><i class="bi bi-tiktok"></i></a>
                    </div>
                <div class="contact-info">
                    <p>
                        WaterBear Education Ltd, Hanover House,<br>
                        118 Queens Road, Brighton BN1 3XG, UK
                    </p>
                    <p>
                        Email: <a href="mailto:info@waterbear.org.uk">info@waterbear.org.uk</a><br>
                        Tel: <a href="tel:+441273726230">+44 (0) 1273 726230</a>
                    </p>

                    <p>
                        WaterBear Sheffield, Unit 4, Gatecrasher,<br>
                        49 Eyre Lane, Sheffield S1 4RB, UK
                    </p>
                    <p>
                        Email: <a href="mailto:infosheffield@waterbear.org.uk">infosheffield@waterbear.org.uk</a><br>
                        Tel: <a href="tel:++441143 992720">+44 (0) 1143 992720</a>
                    </p>
                </div>
            </div>

            <div class="col-lg-4 col-md-12 mb-4 text-center text-lg-start">
                <h5 class="mb-3" style = "font-weight: 600;">Why We're WaterBear...</h5>
                <ul class="footer-why-list">
                    <li>- 'Water bear' is the common name for a Tardigrade.</li>
                    <li>- Tardigrades are micro creatures, found everywhere on earth.</li>
                    <li>- They are the most resilient creatures known.</li>
                    <li>- They can survive and adapt to their surroundings, even in outer space.</li>
                    <li>- Their resilience and ability to adapt and survive inspires us in everything we do. We love them.</li>
                </ul>
            </div>

        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script> 
    
    <script type="module" src="script.js"></script>


<script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful:', registration);
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000); // Check every hour
                        
                        // Handle updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available, could show update prompt here
                                    console.log('New content available, please refresh!');
                                    
                                    // Optional: Show update notification
                                    if (confirm('New version available! Refresh to update?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('ServiceWorker registration failed:', error);
                    });
            });
            
            // Handle controller change
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                window.location.reload();
                refreshing = true;
            });
        }


        // PWA Install Prompt (optional enhancement)
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button (optional)
            showInstallButton();
        });

        function showInstallButton() {
            // Only show if user hasn't already installed
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                // Create install button styled like a mini portal card
                const installBtn = document.createElement('button');
                installBtn.className = 'install-prompt-btn';
                installBtn.innerHTML = `
                    <div class="install-icon">
                        <i data-lucide="plus-square"></i>
                    </div>
                    <div class="install-text">
                        <strong>Add to Home Screen</strong>
                        <small>Get the full app experience</small>
                    </div>
                    <button class="install-dismiss-btn" aria-label="Dismiss">&times;</button>
                `;
                
                // Add CSS for the button
                const style = document.createElement('style');
                style.textContent = `
                    .install-prompt-btn {
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        background: var(--header-color); /* Black for desktop */
                        color: #fff;
                        border: none;
                        /* Increased right padding to make space for the close button */
                        padding: 15px 45px 15px 20px; 
                        border-radius: 8px;
                        font-weight: 700;
                        cursor: pointer;
                        z-index: 1000;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        transition: all 0.3s ease;
                        font-family: 'Futura', 'Jost', sans-serif;
                    }
                    
                    .install-prompt-btn:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                    }
                    
                    .install-icon {
                        flex-shrink: 0;
                    }
                    
                    .install-icon svg {
                        width: 30px;
                        height: 30px;
                        stroke: currentColor;
                    }
                    
                    .install-text {
                        text-align: left;
                    }
                    
                    .install-text strong {
                        display: block;
                        font-size: 14px;
                        margin-bottom: 2px;
                    }
                    
                    .install-text small {
                        display: block;
                        font-size: 11px;
                        font-weight: 400;
                        opacity: 0.8;
                    }

                    .install-dismiss-btn {
                        position: absolute;
                        /* Adjusted position to align better */
                        top: 5px;
                        right: 10px;
                        background: none;
                        border: none;
                        color: #fff;
                        font-size: 24px;
                        line-height: 1;
                        padding: 5px;
                        cursor: pointer;
                        opacity: 0.7;
                    }

                    .install-dismiss-btn:hover {
                        opacity: 1;
                    }
                    
                    @media (max-width: 480px) {
                        .install-prompt-btn {
                            top: 80px; /* Position near the top on mobile */
                            bottom: auto;
                            right: 10px;
                            left: 10px;
                            max-width: calc(100% - 20px);
                            background: var(--accent-yellow); /* Yellow for mobile */
                            color: var(--button-text-color); /* Black text */
                        }

                        .install-prompt-btn .install-dismiss-btn {
                            color: var(--button-text-color); /* Black 'x' to contrast with yellow */
                        }
                    }
                `;
                document.head.appendChild(style);
                
                // Add click listener for the main button to trigger the install prompt
                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`User ${outcome} the install prompt`);
                        deferredPrompt = null;
                        installBtn.remove();
                    }
                });

                // Add click listener for the new dismiss button
                const dismissBtn = installBtn.querySelector('.install-dismiss-btn');
                dismissBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevents the main button's click event
                    installBtn.remove();
                });
                
                document.body.appendChild(installBtn);
                
                // Initialize Lucide icons for the new button
                lucide.createIcons();
            }
        }

        // Hide install button if already installed
        window.addEventListener('appinstalled', () => {
            const installBtn = document.querySelector('.install-prompt-btn');
            if (installBtn) {
                installBtn.remove();
            }
        });
    </script>

</body>
</html>
